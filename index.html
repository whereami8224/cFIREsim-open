<!DOCTYPE html>
<html lang="en" ng-app="cFIREsim">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="A Crowdsourced Financial Independence and Early Retirement Simulator and Calculator. Uses historic stock data to model your retirement and give you a success rate based on all of the possible periods of time in the stock market (good and bad).">
    <title>Crowdsourced Financial Independence and Early Retirement Simulator/Calculator</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#428BCA" />
    <style>
        .dygraph-axis-label-y {
            padding-right: 10px;
            padding-left: 10px;
        }

        .output > span {
            display: none;
        }

            .output > span.highlight {
                display: inline;
            }

        .output {
            color: black;
        }

        #tabNav .nav-pills > li > a {
            border-radius: 4px 4px 0 0;
        }

        #tabNav .tab-content {
            color: white;
            background-color: #428bca;
        }

        .table {
            background-color: white;
            color: black;
        }

        .table-nonfluid {
            width: auto !important;
            font-size: 80%;
        }

            .table-nonfluid th {
                width: auto !important;
            }

            .table-nonfluid th {
                background-color: grey;
            }

        .rowHeaders tr td:first-child {
            background-color: grey;
            font-weight: bold;
        }

        .ot_banner {
            color: white;
            background-color: #e78f08;
            width: 50%;
            float: none;
            margin: 0 auto;
            border: 2px;
            border-radius: 8px;
            padding: 3px;
            text-align: center;
            margin-bottom: 5px;
        }

            .ot_banner a {
                color: #23568f;
            }

        .ot_banner_output {
            color: white;
            background-color: #e78f08;
            width: 50%;
            float: none;
            border: 2px;
            border-radius: 8px;
            padding: 3px;
            text-align: center;
            margin-bottom: 5px;
            margin-top: 5px;
        }

            .ot_banner_output a {
                color: #23568f;
            }

        /**
        * Reset button styles
        * It takes some work to achieve a “blank slate” look.
        */
        button {
        padding: 0;
        border: none;
        font: inherit;
        color: inherit;
        background-color: transparent;
        /* show a hand cursor on hover; some argue that we
        should keep the default arrow cursor for buttons */
        cursor: pointer;
        }

        /**
        * Button component
        */
        input[type=button], .custom-file-upload{
        /* default for <button>, but needed for <a> */
        display: inline-block;
        text-align: center;
        text-decoration: none;
        font-size: 0.8rem;

        /* create a small space when buttons wrap on 2 lines */
        margin: 2px 0;

        /* invisible border (will be colored on hover/focus) */
        border: solid 1px currentColor;  /*transparent;*/
        border-radius: 4px;

        /* button size comes from text + padding, avoid height */
        padding: 0.5em 1em;

        /* make sure colors have enough contrast! */
        color: #666;
        background-color: #FFFFFF;
        }

        /* old-school "down" effect on clic + color tweak */
        input[type=button]:active, .custom-file-upload:active {
        transform: translateY(1px);
        filter: saturate(150%);
        }

        /* inverse colors on hover */
        input[type=button]:hover, .custom-file-upload:hover {
        color: #FFFFFF;
        border-color: transparent;
        background-color: #999;
        }

        /* gray out disabled buttons*/
        input[type=button]:disabled{
        color: #666;
        background-color: #ccc;
        border-color: currentColor
        }

        /* Firefox: remove the inner border shown on focus */
        input[type=button]::-moz-focus-inner {
        border: none;
        }

        /* make sure we have a visible focus ring */
        input[type=button]:focus, .custom-file-upload:focus {
        outline: none;
        box-shadow: 0 0 0 1px #eb989b,
            0 0 0 1px #eb989b;
        border-color: #ec1d24;
        }

        /* hide focus style if not from keyboard navigation */
        .js-focus-visible input[type=button]:focus:not(.focus-visible),
        .js-focus-visible .custom-file-upload:focus:not(.focus-visible) {
        box-shadow: none;
        }

        input.highlight {
        color: #ec1d24;
        }

        input.highlight:hover {
        background-color: #ec1d24;
        }

        input[type="file"]      {
            display: none;
        }

    </style>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-select.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/r/bs/dt-1.10.8/datatables.min.css" />
</head>
<body>
    <div class="page-header">
        <h1 class="text-center">The Crowdsourced FIRE Simulator (cFIREsim) - Open Source</h1>
    </div>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li><button type="button" class="btn btn-default navbar-btn" id="saveSimBtn">Save Simulation Inputs</button></li>
                    <li><button type="button" class="btn btn-default navbar-btn" id="loadSimBtn">Load Saved Sim</button></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <p class="navbar-btn">
                            <a href="faq.html" class="btn btn-default">FAQ/Tutorial</a>
                        </p>
                    </li>
                    <li>
                        <p class="navbar-btn">
                            <a data-toggle="modal" href="#donateModal" class="btn btn-default">Donate/Support</a>
                        </p>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Blogs/Forums <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="http://www.bogleheads.org">Bogleheads</a></li>
                            <li><a href="http://bucking-the-trend.com/">Bucking The Trend</a></li>
                            <li><a href="http://earlyretirementextreme.com/">Early Retirement Extreme</a></li>
                            <li><a href="http://early-retirement.org">Early-Retirement.org</a></li>
                            <li><a href="http://www.gocurrycracker.com/">Go Curry Cracker!</a></li>
                            <li><a href="http://www.1500Days.com/">1500 Days</a></li>
                            <li><a href="http://the-military-guide.com/">Military Retirement</a></li>
                            <li><a href="http://www.mrmoneymustache.com">Mr. Money Mustache</a></li>
                            <li><a href="http://wpfau.blogspot.com/">Wade Pfau's Retirement Research</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Other Calculators/Tools <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="https://www.fidelity.com/calculators-tools/retirement-income-planner">Fidelity Retirement Income Planner</a></li>
                            <li><a href="http://www.firecalc.com">FireCalc</a></li>
                            <li><a href="http://www.i-orp.com/">Optimized Retirement Planner (i-ORP)</a></li>
                            <li><a href="http://www.ssa.gov/estimator/">Social Security Benefits Estimator</a></li>
                            <li><a href="http://www.vanguard.com/us/insights/retirement/plan-for-a-long-retirement-tool">Vanguard Life Expectancy Tool</a></li>
                        </ul>
                    </li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
    </nav>
    <div id="input" ng-controller="simulationInputController">
        <form name="form">
            <div class="row">
                <div class="col-md-12" style="display:none" id="loadedSimHeader">
                    <div class="panel panel-success">
                        <div class="panel-heading" id="loadedSimHeaderText">
                            Successfully loaded
                        </div>
                    </div>
                </div>
                <div class="col-md-12" style="display:none" id="loadedSimFail">
                    <div class="panel panel-danger">
                        <div class="panel-heading" id="loadedSimFailText">
                            Failed to load
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            Getting Started
                        </div>
                        <div class="panel-body">
                            <h4>Welcome to cFIREsim!</h4>
                            <p>cFIREsim is a simulator which tells you if you're ready for FIRE. It uses historical market data from 1871 to present to calculate how your portfolio would have fared throughout history. If the market does no worse than the great depression, 1970's stagflation, or the dotcom bust, will your money last in retirement?</p> 
                            <p>Enter a few simple inputs to find out!</p>
                                <ul>
                                    <li><b>Retirement Year:</b> When will you start withdrawing money from your retirement investments?</li>
                                    <li><b>Retirement End Year:</b> How long will you live?</li>
                                    <li><b>Portfolio Amount:</b> How much do you own currently? </li>
                                    <li><b>Yearly Spending:</b> How much do you expect to withdraw every year?</li>
                                </ul>
                            </p>
                            <p>Hit the "Run Simulation" button, and enjoy your personalized output chart and graph!</p>
                            <p>Pay particular attention to your "Success Rate". This tells you how many simulations your portfolio survived, versus how many times it ran out.</p> 
                            <p>Ready for more? cFIREsim can determine your portfolio success based on 80 individual variables, multiple types of inflation, multiple types of market returns, and graphically show you the results. Look for help topics along the way to learn more.</p>
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="row">
                <div class="col-md-6">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            Timeframe
                        </div>
                        <div class="panel-body">
                            <div class="alert alert-danger" role="alert" id="yearsError" style="display:none">
                                <span class="sr-only">Error:</span>
                                Retirement Start must be >= Simulation Start. Retirement Start must be before Retirement End.
                            </div>
														<label>Simulation Start Year:<input type="text" class="form-control toot" ng-model="data.simulationStartYear" id="simulationStartYear"></label>
                            <label data-toggle="tooltip" data-placement="bottom" title="The year in which you begin withdrawing money from retirement investments. This can be the current year, or any year in the future.">Retirement Year:<input type="text" class="form-control toot" ng-model="data.retirementStartYear" id="retirementStartYear"></label>
                            <label data-toggle="tooltip" data-placement="bottom" title="This is the end year for the simulation. Set this to be in line with your life expectancy estiamtes.">Retirement End Year:<input type="text" class="form-control" ng-model="data.retirementEndYear" id="retirementEndYear"></label>
                            <p>Pre-retirement length = {{ data.retirementStartYear - data.simulationStartYear }} years.</p>
                            <p>Retirement length = {{ data.retirementEndYear - data.retirementStartYear }} years.</p>
                            <p>Total simulation length = {{ data.retirementEndYear - data.simulationStartYear }} years.</p>
                            <!-- cFIREsim Open -->
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            Data Options
                        </div>
                        <div class="alert alert-danger" role="alert" id="dataError" style="display:none">
                            <span class="sr-only">Error:</span>
                            Start Year must be &gt;= 1871. Start Year must be less than End Year. End Year must be less than current year. Total span of years must be > simulation period.
                        </div>
                        <div class="alert alert-danger" role="alert" id="dataRateError" style="display:none">
                            <span class="sr-only">Error:</span>
                            Market Growth must be a positive number.
                        </div>
                        <div class="alert alert-danger" role="alert" id="dataSingleYearError" style="display:none">
                            <span class="sr-only">Error:</span>
                            Start Year must be &gt;= 1871 and early enough to have enough data available for the simulation length.
                        </div>
                        <div class="alert alert-danger" role="alert" id="dataCapeError" style="display:none">
                            <span class="sr-only">Error:</span>
                            CAPE limits must be positive numbers and minimum CAPE must be less than maximum CAPE.
                        </div>
                        <div class="alert alert-danger" role="alert" id="investigateError" style="display:none">
                            <span class="sr-only">Error:</span>
                            Chance of suscess must be &gt;0 and &lt;=100.
                        </div>
                        <div class="panel-body">
                            <label>
                                Data To Use:
                                <select class="form-control"
                                        ng-model="data.data.method"
                                        ng-change="refreshDataForm()"
                                        ng-options="dataOptions.value as dataOptions.text for dataOptions in dataOptionTypes"></select>
                            </label>

                            <div id="historicalSpecificOptions" class="dataOptions" style="display:none">
                                <label>
                                    Starting Data Year:
                                    <div class="input-group">
                                        <input type="text" class="form-control" ng-model="data.data.start">
                                    </div>
                                </label>
                                <label>
                                    Ending Data Year:
                                    <div class="input-group">
                                        <input type="text" class="form-control" ng-model="data.data.end">
                                    </div>
                                </label>
                            </div>
                            <div id="singleCycleOptions" class="dataOptions" style="display:none">
                                <label>
                                    Starting Data Year:
                                    <div class="input-group">
                                        <input type="text" class="form-control" ng-model="data.data.singleStart">
                                    </div>
                                </label>
                            </div>
                            <div id="constantGrowthOptions" class="dataOptions" style="display:none">
                                <label>
                                    Market Growth:
                                    <div class="input-group">
                                        <input type="text" class="form-control" ng-model="data.data.growth">
                                        <span class="input-group-addon">%</span>
                                    </div>
                                </label>
                            </div>
                            <div id="historicalCapeOptions" class="dataOptions" style="display:none">
                                <label>
                                    Minimum Starting Cape:
                                    <div class="input-group">
                                        <input type="text" class="form-control" ng-model="data.data.mincape">
                                    </div>
                                </label>
                                <label>
                                    Maximum Starting Cape:
                                    <div class="input-group">
                                        <input type="text" class="form-control" ng-model="data.data.maxcape">
                                    </div>
                                </label>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <label>
                                        Investigate:
                                        <select class="form-control"
                                                ng-model="data.investigate.type"
                                                ng-change="refreshInvestigateForm()"
                                                ng-options="investigateOptions.value as investigateOptions.text for investigateOptions in investigateOptionTypes"></select>
                                    </label>
                                </div>
                            </div>
                            <div id="maxInitialSpendingOptions" class="dataOptions" style="display:none">
                                <label>
                                    Minimum Success Rate:
                                    <div class="input-group">
                                        <input type="text" class="form-control" ng-model="data.investigate.successRate">
                                        <span class="input-group-addon">%</span>
                                    </div>
                                </label>
                            </div>
                            <br><a data-toggle="modal" href="#outputModal" class="btn btn-success btn-lg runSim" ng-click="runSimulation()">Run Simulation</a>
                            <a data-toggle="modal" href="#outputModal" class="btn btn-success btn-lg runSim" style="display:none" id="showPreviousSimulations">Show Previous Simulations</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="panel panel-primary" id="portfolioPanel">
                        <div class="panel-heading">
                            Portfolio
                        </div>
                        <div class="panel-body">
                            <div class="alert alert-danger" role="alert" id="portfolioError" style="display:none">
                                <span class="sr-only">Error:</span>
                                Portfolio must be a positive number.
                            </div>
                            <label data-toggle="tooltip" data-placement="bottom" title="Your total investable assets. Include all accounts where stocks, bonds, and cash instruments might reside. Do not include pensions, social security, house equity or other income streams in this number.">Portfolio Value:
                                <div class="input-group">
                                    <span class="input-group-addon">$</span>
                                    <input type="number" class="form-control" ng-model="data.portfolio.initial">
                                </div>
                            </label>
                            <div class="panel panel-default" >
                                <div class="panel-heading" data-toggle="tooltip" data-placement="top" title="This is the asset allocation of your portfolio as of today.">
                                    Initial Assets
                                </div>
                                <div class="panel-body" >
                                    <div class="row">
                                        <div class="alert alert-danger" role="alert" id="allocationError" style="display:none">
                                            <span class="sr-only">Error:</span>
                                            Allocations must add up to 100%
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                Equities:
                                                <div class="input-group">
                                                    <input type="text" class="form-control" ng-model="data.portfolio.percentEquities">
                                                    <span class="input-group-addon">%</span>
                                                </div>
                                            </label>
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                Bonds:
                                                <div class="input-group">
                                                    <input type="text" class="form-control" ng-model="data.portfolio.percentBonds">
                                                    <span class="input-group-addon">%</span>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>
                                                Gold:
                                                <div class="input-group">
                                                    <input type="text" class="form-control" ng-model="data.portfolio.percentGold">
                                                    <span class="input-group-addon">%</span>
                                                </div>
                                            </label>
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                Cash:
                                                <div class="input-group">
                                                    <input type="text" class="form-control" ng-model="data.portfolio.percentCash">
                                                    <span class="input-group-addon">%</span>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label data-toggle="tooltip" data-placement="bottom" title="The maintenance/administrative fees that your portfolio requires. This number is calculated against your entire portfolio each year, so please use an average number across all accounts.">
                                                Fees/Drag:
                                                <div class="input-group">
                                                    <input type="text" class="form-control" ng-model="data.portfolio.percentFees">
                                                    <span class="input-group-addon">%</span>
                                                </div>
                                            </label>
                                        </div>
                                        <div class="col-md-6">
                                            <label data-toggle="tooltip" data-placement="bottom" title="Since there is no reliable historical data on cash investments (that I can find), the Growth of Cash input is for the user to determine how much growth over time that your cash allocation receives.">
                                                Growth of Cash:
                                                <div class="input-group">
                                                    <input type="text" class="form-control" ng-model="data.portfolio.growthOfCash">
                                                    <span class="input-group-addon">%</span>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>
                                            Annual Rebalancing Strategy:
                                            <div style="display: flex; flex-direction: row; align-items: center;">
                                                <select class="form-control"
                                                    ng-model="data.portfolio.rebalanceAnnually"
                                                    ng-change="refreshRebalanceAnnuallyOptions()"
                                                    ng-options="rebalanceAnnuallyOptions.value as rebalanceAnnuallyOptions.text for rebalanceAnnuallyOptions in rebalanceAnnuallyOptionsTypes"></select>
                                                <button type="button" class="btn btn-outline-secondary btn-help" data-href="help/rebalance.html" data-title="Annual Rebalancing Strategy">
                                                    <img src="image/help.svg"/>
                                                </button>
                                            </div>        
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-default" id="targetAssets" style="display:none">
                                <div class="panel-heading">
                                    Target Assets
                                </div>
                                <div class="panel-body">
                                    <div class="alert alert-danger" role="alert" id="targetAllocationError" style="display:none">
                                        <span class="sr-only">Error:</span>
                                        Allocations must add up to 100%
                                    </div>
                                    <div class="alert alert-danger" role="alert" id="targetAllocationYearsError" style="display:none">
                                        <span class="sr-only">Error:</span>
                                        Start Year must be greater than simulation start year. End Year must be after Start Year.
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>
                                                Start Year:
                                                <input type="text" class="form-control" ng-model="data.portfolio.changeAllocationStartYear">
                                            </label>
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                End Year:
                                                <input type="text" class="form-control" ng-model="data.portfolio.changeAllocationEndYear">
                                            </label>
                                        </div>
                                    </div><div class="row">
                                        <div class="col-md-6">
                                            <label>
                                                Equities:
                                                <div class="input-group">
                                                    <input type="text" class="form-control" ng-model="data.portfolio.targetPercentEquities">
                                                    <span class="input-group-addon">%</span>
                                                </div>
                                            </label>
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                Bonds:
                                                <div class="input-group">
                                                    <input type="text" class="form-control" ng-model="data.portfolio.targetPercentBonds">
                                                    <span class="input-group-addon">%</span>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label>
                                                Gold:
                                                <div class="input-group">
                                                    <input type="text" class="form-control" ng-model="data.portfolio.targetPercentGold">
                                                    <span class="input-group-addon">%</span>
                                                </div>
                                            </label>
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                Cash:
                                                <div class="input-group">
                                                    <input type="text" class="form-control" ng-model="data.portfolio.targetPercentCash">
                                                    <span class="input-group-addon">%</span>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            Spending Plan
                        </div>
                        <div class="alert alert-danger" role="alert" id="initialSpendingError" style="display:none">
                            <span class="sr-only">Error:</span>
                            Initial Spending amount must be a positive number.
                        </div>
                        <div class="panel-body">
                            <div>
                                <label>
                                    Withdrawal Strategy:
                                    <div style="display: flex; flex-direction: row; align-items: center;">
                                        <select class="form-control"
                                                ng-model="data.spending.method"
                                                ng-change="refreshSpendingForm()"
                                                ng-options="spendingPlan.value as spendingPlan.text for spendingPlan in spendingPlanTypes"></select>
                                        <button type="button" class="btn btn-outline-secondary btn-help" data-href="/help/withdrawal.html" data-title="Withdrawal Strategy">
                                            <img src="image/help.svg"/>
                                        </button>
                                    </div>
                                </label>
                            </div>
                            <div id="yearlySpendingOptions" class="spendingOptions">
                                <label data-toggle="tooltip" data-placement="bottom" title="Your yearly default expenses that will be subtracted from your portfolio.">
                                    Initial Yearly Spending:
                                    <div class="input-group">
                                        <span class="input-group-addon">$</span>
                                        <input type="text" class="form-control" ng-model="data.spending.initial">
                                    </div>
                                </label>
                            </div>
                            <div id="percentageOfPortfolioOptions" class="spendingOptions">
                                <label>
                                    Yearly Spending (% of portfolio):
                                    <div class="input-group">
                                        <input type="text"
                                               class="form-control"
                                               ng-model="data.spending.percentageOfPortfolioPercentage">
                                        <span class="input-group-addon">%</span>
                                    </div>
                                </label>
                                <div id="percentageOfPortfolioLimits">
                                    <label data-toggle="tooltip" data-placement="bottom" title="Prevent the simulation from going to an unreasonable level of spending, by setting the mininum that you want to allow during retirement.">
                                        Floor Spending:
                                        <div class="input-group">
                                            <select class="form-control"
                                                    ng-model="data.spending.percentageOfPortfolioFloorType"
                                                    ng-change="clearProperty(true, 'data.spending.percentageOfPortfolioFloorValue')"
                                                    ng-options="limitType.value as limitType.text for limitType in percentOfPortfolioFloorLimitTypes"></select>
                                        </div>
                                    </label>
                                    <label>
                                        Never Less Than:
                                        <div class="input-group">
                                            <span class="input-group-addon" ng-show="data.spending.percentageOfPortfolioFloorType == 'definedValue'">$</span>
                                            <input type="text"
                                                   class="form-control"
                                                   ng-model="data.spending.percentageOfPortfolioFloorValue"
                                                   ng-disabled="data.spending.percentageOfPortfolioFloorType == 'none' || data.spending.percentageOfPortfolioFloorType == 'pensions'">
                                            <span class="input-group-addon" ng-show="data.spending.percentageOfPortfolioFloorType != 'definedValue'">%</span>
                                        </div>
                                    </label>
                                    <br>
                                    <label data-toggle="tooltip" data-placement="bottom" title="Prevent the simulation from going to an unreasonable level of spending, by setting the maximum that you want to allow during retirement.">
                                        Ceiling Spending:
                                        <div class="input-group">
                                            <select class="form-control"
                                                    ng-model="data.spending.percentageOfPortfolioCeilingType"
                                                    ng-change="clearProperty(true, 'data.spending.percentageOfPortfolioCeilingValue')"
                                                    ng-options="limitType.value as limitType.text for limitType in percentOfPortfolioCeilingLimitTypes"></select>
                                        </div>
                                    </label>
                                    <label>
                                        Never More Than:
                                        <div class="input-group">
                                            <span class="input-group-addon" ng-show="data.spending.percentageOfPortfolioCeilingType == 'definedValue'">$</span>
                                            <input type="text"
                                                   class="form-control"
                                                   ng-model="data.spending.percentageOfPortfolioCeilingValue"
                                                   ng-disabled="data.spending.percentageOfPortfolioCeilingType == 'none'">
                                            <span class="input-group-addon" ng-show="data.spending.percentageOfPortfolioCeilingType != 'definedValue'">%</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <div id="hebelerAutopilotOptions" class="spendingOptions">
                                <label>
                                    Age of Retirement:
                                    <input type="text" class="form-control" ng-model="data.spending.hebelerAgeOfRetirement">
                                </label>
                                <label>
                                    Weighted RMD:
                                    <div class="input-group">
                                        <input type="text"
                                               class="form-control"
                                               ng-model="data.spending.hebelerWeightedRMD">
                                        <span class="input-group-addon">%</span>
                                    </div>
                                </label>
                                <label>
                                    Weighted CPI:
                                    <div class="input-group">
                                        <input type="text"
                                               class="form-control"
                                               ng-model="data.spending.hebelerWeightedCPI">
                                        <span class="input-group-addon">%</span>
                                    </div>
                                </label>
                            </div>
                            <div id="variableSpendingOptions" class="spendingOptions">
                                <label>
                                    Z Value (0.000 - 1.000):
                                    <input type="text" class="form-control" ng-model="data.spending.variableSpendingZValue">
                                </label>
                            </div>
                            <div id="guytonKlingerOptions" class="spendingOptions">
                                <label>
                                    Exceeds:
                                    <div class="input-group">
                                        <input type="text"
                                               class="form-control"
                                               ng-model="data.spending.guytonKlingerExceeds">
                                        <span class="input-group-addon">%</span>
                                    </div>
                                </label>
                                <label>
                                    Cut:
                                    <div class="input-group">
                                        <input type="text"
                                               class="form-control"
                                               ng-model="data.spending.guytonKlingerCut">
                                        <span class="input-group-addon">%</span>
                                    </div>
                                </label>
                                <br>
                                <label>
                                    Fall:
                                    <div class="input-group">
                                        <input type="text"
                                               class="form-control"
                                               ng-model="data.spending.guytonKlingerFall">
                                        <span class="input-group-addon">%</span>
                                    </div>
                                </label>
                                <label>
                                    Raise:
                                    <div class="input-group">
                                        <input type="text"
                                               class="form-control"
                                               ng-model="data.spending.guytonKlingerRaise">
                                        <span class="input-group-addon">%</span>
                                    </div>
                                </label>
                            </div>
                            <div id="vpwOptions" class="spendingOptions">
                                <label>
                                    Rate of Return:
                                    <div class="input-group">
                                        <input type="text"
                                               class="form-control"
                                               ng-model="data.spending.vpwRateOfReturn">
                                        <span class="input-group-addon">%</span>
                                    </div>
                                </label>
                                <label>
                                    Future Value:
                                    <div class="input-group">
                                        <span class="input-group-addon">$</span>
                                        <input type="text" class="form-control" ng-model="data.spending.vpwFutureValue">
                                    </div>
                                </label>
                            </div>
                            <div id="variableCAPEOptions" class="spendingOptions">
                                <label>
                                    Cyclically Adjusted Earnings Yield Multiplier:
                                    <div class="input-group">
                                        <input type="text"
                                               class="form-control"
                                               ng-model="data.spending.variableCAPEMultiplier">
                                        <span class="input-group-addon">*</span>
                                    </div>
                                </label>
                                <label>
                                    Constant Adjustment:
                                    <div class="input-group">
                                        <input type="text" class="form-control" ng-model="data.spending.variableCAPEConstantAdjustment">
                                        <span class="input-group-addon">+</span>
                                    </div>
                                </label>
                            </div>
                            <div id="retireAgainAndAgainOptions" class="spendingOptions">
                                <label>
                                    RAA Target Portfolio Amount:
                                    <div class="input-group">
                                        <select class="form-control"
                                                ng-model="data.spending.retireAgainAmountType"
                                                ng-options="retireAgainAmountType.value as retireAgainAmountType.text for retireAgainAmountType in retireAgainAmountTypes"></select>
                                    </div>
                                </label>
                                <label>
                                    RAA Custom Portfolio Target:
                                    <div class="input-group">
                                        <span class="input-group-addon">$</span>
                                        <input type="text"
                                               class="form-control"
                                               ng-model="data.spending.retireAgainCustomTarget">
                                    </div>
                                </label>
                                <label>
                                    Threshold for Spending Increase:
                                    <div class="input-group">
                                        <input type="text"
                                               class="form-control"
                                               ng-model="data.spending.retireAgainThreshold">
                                        <span class="input-group-addon">%</span>
                                    </div>
                                </label>
                            </div>
                            <div id="spendingLimitOptions" class="spendingOptions">
                                <label>
                                    Spending Floor (Inflation Adjusted):
                                    <select class="form-control"
                                            ng-model="data.spending.floor"
                                            ng-options="floor.value as floor.text for floor in spendingFloorTypes"></select>
                                </label>
                                <div class="input-group">
                                    <span class="input-group-addon">$</span>
                                    <input type="text"
                                           class="form-control"
                                           ng-model="data.spending.floorValue"
                                           ng-disabled="data.spending.floor != 'definedValue'">
                                </div>
                                <label>
                                    Spending Ceiling (Inflation Adjusted):
                                    <select class="form-control"
                                            ng-model="data.spending.ceiling"
                                            ng-options="ceiling.value as ceiling.text for ceiling in spendingCeilingTypes"></select>
                                </label>
                                <div class="input-group">
                                    <span class="input-group-addon">$</span>
                                    <input type="text"
                                           class="form-control"
                                           ng-model="data.spending.ceilingValue"
                                           ng-disabled="data.spending.ceiling != 'definedValue'">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            Income
                        </div>
                        <div class="panel-body">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    Social Security
                                </div>
                                <div class="panel-body">
                                    <div class="alert alert-danger" role="alert" id="ssError" style="display:none">
                                        <span class="sr-only">Error:</span>
                                        Start Year must be &gt;= simulation start year. Start Year must be less than End Year.
                                    </div>
                                    <div class="alert alert-danger" role="alert" id="ssValueError" style="display:none">
                                        <span class="sr-only">Error:</span>
                                        Amount must be a positive number.
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <label>
                                                Annual Amount:
                                                <div class="input-group">
                                                    <span class="input-group-addon">$</span>
                                                    <input type="text" class="form-control" ng-model="data.extraIncome.socialSecurity.val">
                                                </div>
                                            </label>
                                        </div>
                                        <div class="col-md-4">
                                            <label>Start Year:<input type="text" class="form-control" ng-model="data.extraIncome.socialSecurity.startYear"></label>
                                        </div>
                                        <div class="col-md-4">
                                            <label>End Year:<input type="text" class="form-control" ng-model="data.extraIncome.socialSecurity.endYear"></label>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <label>
                                                Annual Spousal Amount:
                                                <div class="input-group">
                                                    <span class="input-group-addon">$</span>
                                                    <input type="text" class="form-control" ng-model="data.extraIncome.socialSecuritySpouse.val">
                                                </div>
                                            </label>
                                        </div>
                                        <div class="col-md-4">
                                            <label>Start Year:<input type="text" class="form-control" ng-model="data.extraIncome.socialSecuritySpouse.startYear"></label>
                                        </div>
                                        <div class="col-md-4">
                                            <label>End Year:<input type="text" class="form-control" ng-model="data.extraIncome.socialSecuritySpouse.endYear"></label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    Pensions
                                </div>
                                <div class="panel-body">
                                    <div class="alert alert-danger" role="alert" id="pensionsError" style="display:none">
                                        <span class="sr-only">Error:</span>
                                        Pension Start Year must be &gt;= the simulation start year and must be an integer.
                                    </div>
                                    <div class="alert alert-danger" role="alert" id="pensionsValueError" style="display:none">
                                        <span class="sr-only">Error:</span>
                                        Amount must be a positive number.
                                    </div>
                                    <div class="alert alert-danger" role="alert" id="pensionsRateError" style="display:none">
                                        <span class="sr-only">Error:</span>
                                        Pension inflation rate must be a positive number.
                                    </div>
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th id="p_label">
                                                    Label
                                                </th>
                                                <th id="p_amount">
                                                    Annual Amount
                                                </th>
                                                <th id="p_year">
                                                    Start Year
                                                </th>
                                                <th id="p_infadj">
                                                    Inflation Adjusted
                                                </th>
                                                <th id="p_inftyp">
                                                    Inflation Type
                                                </th>
                                                <th id="p_infrate">
                                                    Inflation Rate
                                                </th>
                                                <th>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="pension in data.extraIncome.pensions">
                                                <td>
                                                    <input type="text" class="form-control" ng-model="pension.label" aria-labelledby="p_label">
                                                </td>
                                                <td>
                                                    <div class="input-group">
                                                        <span class="input-group-addon">$</span>
                                                        <input type="text" class="form-control" ng-model="pension.val" aria-labelledby="p_amount">
                                                    </div>
                                                </td>
                                                <td>
                                                    <input type="text" class="form-control" ng-model="pension.startYear" aria-labelledby="p_amount">
                                                </td>
                                                <td>
                                                    <select class="form-control"
                                                            ng-model="pension.inflationAdjusted"
                                                            ng-options="bool for bool in boolOptions"
                                                            ng-change="changeInflationAdjusted($index, data.extraIncome.pensions)"
                                                            aria-labelledby="p_infadj"></select>
                                                </td>
                                                <td>
                                                    <select class="form-control"
                                                            ng-model="pension.inflationType"
                                                            ng-options="option.value as option.text for option in inflationTypes"
                                                            ng-change="changeInflationType($index, data.extraIncome.pensions)"
                                                            ng-disabled="!pension.inflationAdjusted"
                                                            aria-labelledby="p_inftyp"></select>
                                                </td>
                                                <td>
                                                    <div class="input-group">
                                                        <input type="text"
                                                           class="form-control"
                                                           ng-model="pension.inflationRate"
                                                           ng-disabled="pension.inflationType != 'constant' || !pension.inflationAdjusted"
                                                           aria-labelledby="p_infrate">
                                                        <span class="input-group-addon">%</span>
                                                        </div>
                                                </td>
                                                <td>
                                                    <button type="button" class="btn btn-default" ng-click="removeObject($index, data.extraIncome.pensions)">Delete</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <button type="button" class="btn btn-default" ng-click="addObject(data.extraIncome.pensions)" class="btn btn-default">Add Pension</button>
                                </div>
                            </div>
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    Other Income
                                </div>
                                <div class="alert alert-danger" role="alert" id="extraIncomeRateError" style="display:none">
                                    <span class="sr-only">Error:</span>
                                    Extra Income inflation rate must be a positive number.
                                </div>
                                <div class="alert alert-danger" role="alert" id="extraIncomeValueError" style="display:none">
                                    <span class="sr-only">Error:</span>
                                    Amount must be a positive number.
                                </div>
                                <div class="alert alert-danger" role="alert" id="extraIncomeError" style="display:none">
                                    <span class="sr-only">Error:</span>
                                    Start Year must be >= current year. Start Year must be less than End Year.
                                </div>
                                <div class="panel-body">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th id="i_label">
                                                    Label
                                                </th>
                                                <th id="i_amount">
                                                    Annual Amount
                                                </th>
                                                <th id="i_type">
                                                    Recurring
                                                </th>
                                                <th id="i_syear">
                                                    Start Year
                                                </th>
                                                <th id="i_eyear">
                                                    End Year
                                                </th>
                                                <th id="i_infadj">
                                                    Inflation Adjusted
                                                </th>
                                                <th id="i_inftyp">
                                                    Inflation Type
                                                </th>
                                                <th id="i_infrate">
                                                    Inflation Rate
                                                </th>
                                                <th>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="extraSaving in data.extraIncome.extraSavings">
                                                <td>
                                                    <input type="text" class="form-control" ng-model="extraSaving.label" aria-labelledby="i_label">
                                                </td>
                                                <td>
                                                    <div class="input-group">
                                                        <span class="input-group-addon">$</span>
                                                        <input type="text" class="form-control" ng-model="extraSaving.val" aria-labelledby="i_amount">
                                                    </div>
                                                </td>
                                                <td>
                                                    <select class="form-control"
                                                            ng-model="extraSaving.recurring"
                                                            ng-options="bool for bool in boolOptions"
                                                            ng-change="clearEndYear($index, data.extraIncome.extraSavings)"
                                                            aria-labelledby="i_type"></select>
                                                </td>
                                                <td>
                                                    <input type="text" class="form-control" ng-model="extraSaving.startYear" aria-labelledby="i_syear">
                                                </td>
                                                <td>
                                                    <input type="text"
                                                           class="form-control"
                                                           ng-model="extraSaving.endYear"
                                                           ng-disabled="!extraSaving.recurring"
                                                           aria-labelledby="i_eyear">
                                                </td>
                                                <td>
                                                    <select class="form-control"
                                                            ng-model="extraSaving.inflationAdjusted"
                                                            ng-options="bool for bool in boolOptions"
                                                            ng-change="changeInflationAdjusted($index, data.extraIncome.extraSavings)"
                                                            aria-labelledby="i_infadj"></select>
                                                </td>
                                                <td>
                                                    <select class="form-control"
                                                            ng-model="extraSaving.inflationType"
                                                            ng-options="option.value as option.text for option in inflationTypes"
                                                            ng-change="changeInflationType($index, data.extraIncome.extraSavings)"
                                                            ng-disabled="!extraSaving.inflationAdjusted"
                                                            aria-labelledby="i_inftyp"></select>
                                                </td>
                                                <td>
                                                    <div class="input-group">
                                                    <input type="text"
                                                           class="form-control"
                                                           ng-model="extraSaving.inflationRate"
                                                           ng-disabled="extraSaving.inflationType != 'constant' || !extraSaving.inflationAdjusted"
                                                           aria-labelledby="i_infrate">
                                                    <span class="input-group-addon">%</span>
                                                    </div>
                                                </td>
                                                <td>
                                                    <button type="button" class="btn btn-default" ng-click="removeObject($index, data.extraIncome.extraSavings)">Delete</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <button type="button" class="btn btn-default" ng-click="addObject(data.extraIncome.extraSavings)" class="btn btn-default">Add Income</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            Individual Expenses
                        </div>
                        <div class="panel-body">
                            <div class="panel panel-default">
                                <div class="alert alert-danger" role="alert" id="extraSpendingError" style="display:none">
                                    <span class="sr-only">Error:</span>
                                    Start Year must be &gt;= current year. Start Year must be less than End Year.
                                </div>
                                <div class="alert alert-danger" role="alert" id="extraSpendingValueError" style="display:none">
                                    <span class="sr-only">Error:</span>
                                    Amount must be a positive number.
                                </div>
                                <div class="alert alert-danger" role="alert" id="extraSpendingRateError" style="display:none">
                                    <span class="sr-only">Error:</span>
                                    Inflation Rate for Spending must be a positive number.
                                </div>
                                <div class="panel-body">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th id="s_label">
                                                    Label
                                                </th>
                                                <th id="s_amount">
                                                    Annual Amount
                                                </th>
                                                <th id="s_type">
                                                    Recurring
                                                </th>
                                                <th id="s_syear">
                                                    Start Year
                                                </th>
                                                <th id="s_eyear">
                                                    End Year
                                                </th>
                                                <th id="s_infadj">
                                                    Inflation Adjusted
                                                </th>
                                                <th id="s_inftyp">
                                                    Inflation Type
                                                </th>
                                                <th id="s_infrate">
                                                    Inflation Rate
                                                </th>
                                                <th>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="extraSpending in data.extraSpending">
                                                <td>
                                                    <input type="text" class="form-control" ng-model="extraSpending.label" aria-labelledby="s_label">
                                                </td>
                                                <td>
                                                    <div class="input-group">
                                                        <span class="input-group-addon">$</span>
                                                        <input type="text" class="form-control" ng-model="extraSpending.val" aria-labelledby="s_amount">
                                                    </div>
                                                </td>
                                                <td>
                                                    <select class="form-control"
                                                            ng-model="extraSpending.recurring"
                                                            ng-options="bool for bool in boolOptions"
                                                            ng-change="clearEndYear($index, data.extraSpending)"
                                                            aria-labelledby="s_type"></select>
                                                </td>
                                                <td>
                                                    <input type="text"
                                                           class="form-control"
                                                           ng-model="extraSpending.startYear"
                                                           aria-labelledby="s_syear">
                                                </td>
                                                <td>
                                                    <input type="text"
                                                           class="form-control"
                                                           ng-model="extraSpending.endYear"
                                                           ng-disabled="!extraSpending.recurring"
                                                           aria-labelledby="s_eyear">
                                                </td>
                                                <td>
                                                    <select class="form-control"
                                                            ng-model="extraSpending.inflationAdjusted"
                                                            ng-options="bool for bool in boolOptions"
                                                            ng-change="changeInflationAdjusted($index, data.extraSpending)"
                                                            aria-labelledby="s_infadj"></select>
                                                </td>
                                                <td>
                                                    <select class="form-control"
                                                            ng-model="extraSpending.inflationType"
                                                            ng-options="option.value as option.text for option in inflationTypes"
                                                            ng-change="changeInflationType($index, data.extraSpending)"
                                                            ng-disabled="!extraSpending.inflationAdjusted"
                                                            aria-labelledby="s_inftyp"></select>
                                                </td>
                                                <td>
                                                    <div class="input-group">
                                                        <input type="text"
                                                            class="form-control"
                                                            ng-model="extraSpending.inflationRate"
                                                            ng-disabled="extraSpending.inflationType != 'constant' || !extraSpending.inflationAdjusted"
                                                            aria-labelledby="s_infrate">
                                                        <span class="input-group-addon">%</span>
                                                    </div>
                                                </td>
                                                <td>
                                                    <button type="button" class="btn btn-default" ng-click="removeObject($index, data.extraSpending)">Delete</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <button type="button" class="btn btn-default" ng-click="addObject(data.extraSpending)" class="btn btn-default">Add Expense</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <a data-toggle="modal" href="#outputModal" class="btn btn-success btn-lg runSim" ng-click="runSimulation()">Run Simulation</a>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="outputModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title">cFIREsim Simulation Cycles</h4>
                </div>
                <div class="modal-body" id="output">
                    <div id="tabNav" class="container-fullwidth">
                        <ul class="nav nav-pills" id="tabNames">
                            <li class="active"><a href="#1a" data-toggle="tab">Sim 1</a></li>
                            <li style="display:none"><a href="#2a" data-toggle="tab">Sim 2</a></li>
                            <li style="display:none"><a href="#3a" data-toggle="tab">Sim 3</a></li>
                            <li style="display:none"><a href="#4a" data-toggle="tab">Sim 4</a></li>
                            <li style="display:none"><a href="#5a" data-toggle="tab">Sim 5</a></li>
                            <li style="display:none"><a href="#6a" data-toggle="tab">Sim 6</a></li>
                            <li style="display:none"><a href="#7a" data-toggle="tab">Sim 7</a></li>
                            <li style="display:none"><a href="#8a" data-toggle="tab">Sim 8</a></li>
                            <li style="display:none"><a href="#9a" data-toggle="tab">Sim 9</a></li>
                            <li style="display:none"><a href="#10a" data-toggle="tab">Sim 10</a></li>
                        </ul>
                        <!--
                        Tabs are stubbed out here, because if they do not exist at load time, the output graphs cannot be written to.
                        -->
                        <div class="tab-content clearfix">
                            <div class="tab-pane active" id="1a">
                                <div style="margin:15px">
                                    <div id='graph1' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels1' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='graph1b' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels1b' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='download1'></div>
                                    <p>
                                        <h1>
                                            Statistics
                                        </h1>
                                    </p>
                                    <table id='stats1a' class="table table-bordered table-nonfluid display compact"></table>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <table id='stats1b' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats1c' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats1d' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats1e' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class="tab-pane" id="2a">
                                <div style="margin:15px">
                                    <div id='graph2' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels2' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='graph2b' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels2b' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='download2'></div>
                                    <p>
                                        <h1>
                                            Statistics
                                        </h1>
                                    </p>
                                    <table id='stats2a' class="table table-bordered table-nonfluid display compact"></table>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <table id='stats2b' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats2c' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats2d' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats2e' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="3a">
                                <div style="margin:15px">
                                    <div id='graph3' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels3' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='graph3b' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels3b' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='download3'></div>
                                    <p>
                                        <h1>
                                            Statistics
                                        </h1>
                                    </p>
                                    <table id='stats3a' class="table table-bordered table-nonfluid display compact"></table>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <table id='stats3b' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats3c' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats3d' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats3e' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="4a">
                                <div style="margin:15px">
                                    <div id='graph4' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels4' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='graph4b' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels4b' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='download4'></div>
                                    <p>
                                        <h1>
                                            Statistics
                                        </h1>
                                    </p>
                                    <table id='stats4a' class="table table-bordered table-nonfluid display compact"></table>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <table id='stats4b' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats4c' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats4d' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats4e' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="5a">
                                <div style="margin:15px">
                                    <div id='graph5' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels5' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='graph5b' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels5b' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='download5'></div>
                                    <p>
                                        <h1>
                                            Statistics
                                        </h1>
                                    </p>
                                    <table id='stats5a' class="table table-bordered table-nonfluid display compact"></table>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <table id='stats5b' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats5c' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats5d' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats5e' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="6a">
                                <div style="margin:15px">
                                    <div id='graph6' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels6' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='graph6b' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels6b' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='download6'></div>
                                    <p>
                                        <h1>
                                            Statistics
                                        </h1>
                                    </p>
                                    <table id='stats6a' class="table table-bordered table-nonfluid display compact"></table>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <table id='stats6b' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats6c' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats6d' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats6e' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="7a">
                                <div style="margin:15px">
                                    <div id='graph7' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels7' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='graph7b' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels7b' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='download7'></div>
                                    <p>
                                        <h1>
                                            Statistics
                                        </h1>
                                    </p>
                                    <table id='stats7a' class="table table-bordered table-nonfluid display compact"></table>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <table id='stats7b' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats7c' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats7d' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats7e' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="8a">
                                <div style="margin:15px">
                                    <div id='graph8' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels8' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='graph8b' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels8b' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='download8'></div>
                                    <p>
                                        <h1>
                                            Statistics
                                        </h1>
                                    </p>
                                    <table id='stats8a' class="table table-bordered table-nonfluid display compact"></table>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <table id='stats8b' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats8c' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats8d' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats8e' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="9a">
                                <div style="margin:15px">
                                    <div id='graph9' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels9' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='graph9b' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels9b' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='download9'></div>
                                    <p>
                                        <h1>
                                            Statistics
                                        </h1>
                                    </p>
                                    <table id='stats9a' class="table table-bordered table-nonfluid display compact"></table>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <table id='stats9b' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats9c' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats9d' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats9e' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="10a">
                                <div style="margin:15px">
                                    <div id='graph10' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels10' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='graph10b' style='width:800px; height:400px;background:white;' class='output'></div>
                                    <div id='labels10b' style='background:white;width:800px;height:20px;' class='output'></div>
                                    <div id='download10'></div>
                                    <p>
                                        <h1>
                                            Statistics
                                        </h1>
                                    </p>
                                    <table id='stats10a' class="table table-bordered table-nonfluid display compact"></table>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <table id='stats10b' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats10c' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats10d' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                        <div class="col-md-6">
                                            <table id='stats10e' class="table table-bordered table-nonfluid display compact rowHeaders"></table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <!-- Donate/Support Modal -->
    <div class="modal fade" id="donateModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title">Donate/Support cFIREsim</h4>
                </div>
                <div class="modal-body">
                    <p>
                        There are a few ways to donate or support cFIREsim
                    </p>
                    <ul>
                        <li>
                            You can log in to the <a href="https://github.com/alistair-marshall/cFIREsim-open/issues">GitHub Issues page</a> and contribute to the cFIREsim Open project by coding a feature/bugfix.
                        </li>
                        <!--li>
                            You can donate via Paypal to support the web hosting fees of this site.
                            <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
                                <input type="hidden" name="cmd" value="_s-xclick">
                                <input type="hidden" name="hosted_button_id" value="6GFG7N3JXP8HN">
                                <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
                                <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
                            </form>
                        </li-->
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Save Sim Modal -->
    <div class="modal fade" id="saveSimPopup" tabindex="" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title">Save Simulation Inputs</h4>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <span class='input-group-addon'>Saved Simulation Name:</span><input type='text' size='12' class='form-control' id='simNameInput'>
                    </div><br>
                    <button type="button" class="btn btn-success" id="confirmSaveSim">Save Sim</button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div> <!-- End Save Sim Modal -->
    <!-- Load Sim Modal -->
    <div class="modal fade" id="loadSimPopup" tabindex="" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title">Load Simulation Inputs</h4>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <label for="file" clas="custom-file-upload">Select File</label>
                        <input id="file" type="file" accept=".FIREsim"/>
                    </div><br>
                    <button type="button" class="btn btn-success" id="confirmLoadSim">Load Sim</button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div> <!-- End Save Sim Modal -->
    <!-- Help Modal -->
    <div class="modal fade" id="helpPopup" tabindex="" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title">Help</h4>
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div> <!-- End Help Modal -->

    <div id="saveSimSuccess" style="display:none" class="popup small">
        <p>Your simulation was successfully saved</p>
        <button type="button" class="btn btn-danger" id="closeSaveSuccess">Close</button>
    </div>

<script type='text/javascript' src='https://code.jquery.com/jquery-3.4.1.min.js'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dygraph/2.1.0/dygraph.min.js" defer></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/bootstrap-select.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.9/angular.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/r/bs/dt-1.10.8/datatables.min.js" defer></script>
<script type="text/javascript" src="js/accounting.min.js" defer></script>
<script type="text/javascript" src="js/cFIREsimOpen.js"></script>
<script type="text/javascript" src="js/marketData.js" defer></script>
<script type="text/javascript" src="js/spendingModule.js" defer></script>
<script type="text/javascript" src="js/statsModule.js" defer></script>
<script type="text/javascript" src="js/validation.js" defer></script>
<script type="text/javascript">
    angular.module('cFIREsim', [])
        .controller('simulationInputController', ['$scope',
            function ($scope) {
                $scope.data = {
                    simulationStartYear: new Date().getFullYear(),
                    retirementStartYear: new Date().getFullYear(),
                    retirementEndYear: new Date().getFullYear() + 30,
                    data: {
                        method: "historicalAll",
                        start: 1900,
                        end: 1970,
                        growth: 8,
                        singleStart: 1966,
                        maxcape: null,
                        mincape: null
                    },
                    investigate: {
                        type: "none",
                        successRate: 95
                    },
                    portfolio: {
                        initial: 1000000,
                        percentEquities: 75,
                        percentBonds: 25,
                        percentGold: 0,
                        percentCash: 0,
                        percentFees: 0.18,
                        growthOfCash: 0.25,
                        rebalanceAnnually: 1,
                        changeAllocationStartYear: new Date().getFullYear(),
                        changeAllocationEndYear: new Date().getFullYear()+10,
                        targetPercentEquities: 100,
                        targetPercentBonds: 0,
                        targetPercentGold: 0,
                        targetPercentCash: 0
                    },
                    spending: {
                        initial: 40000,
                        method: 'inflationAdjusted',
                        floor: 'pensions',
                        ceiling: 'none',
                        percentageOfPortfolioType: 'constant',
                        percentageOfPortfolioFloorType: 'pensions',
                        percentageOfPortfolioCeilingType: 'none',
                        percentageOfPortfolioPercentage: 4,
                        retireAgainAmountType: 'valueAtRetirement',
                        hebelerAgeOfRetirement: 60,
                        hebelerWeightedCPI: 50,
                        hebelerWeightedRMD: 50,
                        variableSpendingZValue: 0.5,
                        guytonKlingerExceeds: 20,
                        guytonKlingerFall: 20,
                        guytonKlingerRaise: 10,
                        guytonKlingerCut: 10,
                        vpwRateOfReturn: 4.3,
                        vpwFutureValue: 0,
                        variableCAPEMultiplier: 0.5,
                        variableCAPEConstantAdjustment: 1
                    },
                    extraIncome: {
                        socialSecurity: {
                            val: 0,
                            startYear: 2032,
                            endYear: 2100
                        },
                        socialSecuritySpouse: {
                            val: 0,
                            startYear: 2032,
                            endYear: 2100
                        },
                        pensions: [{
                            label: 'One',
                            val: 0,
                            startYear: 2030,
                            endYear: null,
                            recurring: true,
                            inflationAdjusted: true,
                            inflationType: 'CPI',
                            inflationRate: ''
                        }, {
                            label: 'Two',
                            val: 0,
                            startYear: 2030,
                            endYear: null,
                            recurring: true,
                            inflationAdjusted: true,
                            inflationType: 'CPI',
                            inflationRate: ''
                        }],
                        extraSavings: [{
                            label: 'One',
                            val: 0,
                            startYear: 2030,
                            endYear: 2035,
                            recurring: true,
                            inflationAdjusted: true,
                            inflationType: 'CPI',
                            inflationRate: ''
                        }, {
                            label: 'Two',
                            val: 0,
                            startYear: 2031,
                            endYear: 2041,
                            recurring: true,
                            inflationAdjusted: true,
                            inflationType: 'CPI',
                            inflationRate: ''
                        }]
                    },
                    extraSpending: [{
                        label: 'One',
                        val: 0,
                        startYear: 2030,
                        endYear: 2040,
                        recurring: true,
                        inflationAdjusted: true,
                        inflationType: 'CPI',
                        inflationRate: ''
                    }, {
                        label: 'Two',
                        val: 0,
                        startYear: 2030,
                        endYear: 2041,
                        recurring: true,
                        inflationAdjusted: true,
                        inflationType: 'CPI',
                        inflationRate: ''
                    }]
                }
                $scope.boolOptions = [
                    true,
                    false
                ]
                $scope.inflationTypes = [{
                    text: 'CPI',
                    value: 'CPI'
                }, {
                    text: 'Constant %',
                    value: 'constant'
                }]
                $scope.dataOptionTypes = [{
                    text: 'Historical Data - All',
                    value: 'historicalAll'
                }, {
                    text: 'Historical Data - Specific Years',
                    value: 'historicalSpecific',
                    formInputs: [
                        'historicalSpecificOptions'
                    ]
                }, {
                    text: 'Constant Market Growth',
                    value: 'constant',
                    formInputs: [
                        'constantGrowthOptions'
                    ]
                }, {
                    text: 'Single Simulation Cycle',
                    value: 'singleCycle',
                    formInputs: [
                        'singleCycleOptions'
                    ]
                }, {
                    text: 'Historical Data - Cape Filtered',
                    value: 'historicalCape',
                    formInputs: [
                        'historicalCapeOptions'
                    ]
                }]
                $scope.investigateOptionTypes = [{
                    text: 'None ',
                    value: 'none',
                },
                {
                    text: 'Max Initial Spending',
                    value: 'maxInitialSpending',
                    formInputs: [
                        'maxInitialSpendingOptions'
                    ]
                },
                {
                    text: 'Retirement Year',
                    value: 'retirementYear',
                    formInputs: [
                        'maxInitialSpendingOptions'
                    ]
                }]
                $scope.rebalanceAnnuallyOptionsTypes = [{
                    text: 'None',
                    value: 0
                },
                {
                    text: 'Constant',
                    value: 1
                },
                {
                    text: 'Glidepath',
                    value: 2
                },
                {
                    text: 'Bonds First',
                    value: 3
                },
                {
                    text: 'OmegaNot',
                    value: 4
                }]
                $scope.spendingPlanTypes = [{
                    text: 'Inflation Adjusted',
                    value: 'inflationAdjusted',
                    formInputs: [
                        'yearlySpendingOptions'
                    ]
                }, {
                    text: 'Not Inflation Adjusted',
                    value: 'notInflationAdjusted',
                    formInputs: [
                        'yearlySpendingOptions',
                        'spendingLimitOptions'
                    ]
                }, {
                    text: '% of Portfolio',
                    value: 'percentOfPortfolio',
                    formInputs: [
                        'percentageOfPortfolioOptions'
                    ]
                }, {
                    text: 'Hebeler Autopilot',
                    value: 'hebelerAutopilot',
                    formInputs: [
                        'yearlySpendingOptions',
                        'hebelerAutopilotOptions',
                        'spendingLimitOptions'
                    ]
                }, {
                    text: 'Variable Spending',
                    value: 'variableSpending',
                    formInputs: [
                        'yearlySpendingOptions',
                        'variableSpendingOptions',
                        'spendingLimitOptions'
                    ]
                }, {
                    text: 'Guyton-Klinger',
                    value: 'guytonKlinger',
                    formInputs: [
                        'yearlySpendingOptions',
                        'guytonKlingerOptions',
                        'spendingLimitOptions'
                    ]
                }, {
                    text: 'VPW',
                    value: 'vpw',
                    formInputs: [
                        'vpwOptions',
                        'spendingLimitOptions'
                    ]
                }, {
                    text: 'Variable CAPE',
                    value: 'variableCAPE',
                    formInputs: [
                        'variableCAPEOptions',
                        'spendingLimitOptions'
                    ]
                }
                    /*,{
               text: 'Retire Again and Again',
               value: 'retireAgainAndAgain',
               formInputs: [
               'yearlySpendingOptions',
               'retireAgainAndAgainOptions',
               'spendingLimitOptions'
               ]
               }
               ,{
               text: 'Original VPW',
               value: 'originalVPW',
               formInputs: [
               'spendingLimitOptions'
               ]
               },{
               text: 'Custom VPW',
               value: 'customVPW',
               formInputs: [
               'yearlySpendingOptions',
               'customVPWOptions',
               'spendingLimitOptions'
               ]
               }*/
                ]
                $scope.spendingFloorTypes = [
                    {
                        text: 'No Floor',
                        value: 'none'
                    },
                    {
                        text: 'Pensions/SS',
                        value: 'pensions'
                    },
                    {
                        text: 'Defined Value',
                        value: 'definedValue'
                    }
                ]
                $scope.spendingCeilingTypes = [
                    {
                        text: 'No Ceiling',
                        value: 'none'
                    },
                    {
                        text: 'Defined Value',
                        value: 'definedValue'
                    }
                ]
                $scope.percentOfPortfolioFloorLimitTypes = [
                    {
                        text: 'No Floor',
                        value: 'none'
                    },
                    {
                        text: 'Pensions/SS',
                        value: 'pensions'
                    },
                    {
                        text: 'Defined Value',
                        value: 'definedValue'
                    },
                    {
                        text: 'As a % of Starting Portfolio',
                        value: 'percentageOfPortfolio'
                    },
                    {
                        text: '% of Previous Year',
                        value: 'percentageOfPreviousYear'
                    }
                ]
                $scope.percentOfPortfolioCeilingLimitTypes = [
                    {
                        text: 'No Ceiling',
                        value: 'none'
                    },
                    {
                        text: 'Defined Value',
                        value: 'definedValue'
                    },
                    {
                        text: 'As a % of Starting Portfolio',
                        value: 'percentageOfPortfolio'
                    }
                ]
                $scope.retireAgainAmountTypes = [{
                    text: 'Portfolio Value at Retirement',
                    value: 'valueAtRetirement'
                }, {
                    text: 'Custom Portfolio Value',
                    value: 'customValue'
                }]
                // Refreshes the spending form by hiding all the sections, showing the correct ones, then wiping the data in the still hidden ones.
                $scope.refreshSpendingForm = function () {
                    var spendingPlan = $.grep($scope.spendingPlanTypes, function (spendingPlanType) {
                        return spendingPlanType.value == $scope.data.spending.method
                    });
                    $('.spendingOptions').hide();
                    if (spendingPlan.length == 1) {
                        $.each(spendingPlan[0].formInputs, function (index, formInput) {
                            $('#' + formInput).show();
                        });
                    }
                    //Removed clearing of fields, so that initial spending value wouldn't disappear when percentOfPortfolio was selected. I don't think this adversely affects the code, but will leave this for posterity.
                    //$scope.clearFields('.spendingOptions:hidden');
                }
                $scope.refreshDataForm = function () {
                    if ($scope.data.data.method == "historicalSpecific") {
                        $('#historicalSpecificOptions').show();
                        $('#constantGrowthOptions').hide();
                        $('#singleCycleOptions').hide();
                        $('#historicalCapeOptions').hide();
                    } else if ($scope.data.data.method == "constant") {
                        $('#constantGrowthOptions').show();
                        $('#historicalSpecificOptions').hide();
                        $('#singleCycleOptions').hide();
                        $('#historicalCapeOptions').hide();
                    } else if ($scope.data.data.method == "historicalAll") {
                        $('#constantGrowthOptions').hide();
                        $('#historicalSpecificOptions').hide();
                        $('#singleCycleOptions').hide();
                        $('#historicalCapeOptions').hide();
                    } else if ($scope.data.data.method == "singleCycle") {
                        $('#singleCycleOptions').show();
                        $('#constantGrowthOptions').hide();
                        $('#historicalSpecificOptions').hide();
                        $('#historicalCapeOptions').hide();
                    } else if ($scope.data.data.method == "historicalCape") {
                        $('#historicalCapeOptions').show();
                        $('#constantGrowthOptions').hide();
                        $('#historicalSpecificOptions').hide();
                        $('#singleCycleOptions').hide();
                    }
                }
                $scope.refreshInvestigateForm = function () {
                    if ($scope.data.investigate.type == "maxInitialSpending" || $scope.data.investigate.type == "retirementYear") {
                        $('#maxInitialSpendingOptions').show();
                    } else {
                        $('#maxInitialSpendingOptions').hide();
                    }

                }
                // Clears all the inputs and selects within the items returned by the selector.
                $scope.clearFields = function (selector) {
                    // For the spending option sections which are still hidden, clear their values.
                    $.each($(selector), function (index, option) {
                        $('input', option).val('');
                        $('select', option).prop('selectedIndex', 0);
                        // If called without the timeout Angular with throw and error the first time this function is called.
                        setTimeout(
                            function () {
                                $('select', option).trigger('change')
                            }, 0, option);
                    });
                }
                $scope.runSimulation = function () {
                    Simulation.runSimulation($scope.data);
                }
                $scope.saveSimulation = function () {
                    console.log($scope.data);
                    var uri = 'data:text/csv;charset=utf-8,' + JSON.stringify($scope.data);
                    var link = document.createElement("a");
                    link.href = uri;
                    //set the visibility hidden so it will not effect on your web-layout
                    link.style = "visibility:hidden";
                    link.download = "simulation.json";
                    //this part will append the anchor tag and remove it after automatic click
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
                $scope.loadSimulation = function () {
                    // $scope.data =
                    //Load from JSON
                }
                $scope.refreshRebalanceAnnuallyOptions = function () {
                    if ($scope.data.portfolio.rebalanceAnnually == 2) {
                        $('#targetAssets').show();
                    } else {
                        $('#targetAssets').hide();
                    }
                }
                // Adds a saving or pension object.
                $scope.addObject = function (array) {
                    array.push({
                        label: '',
                        val: 0,
                        startYear: 2030,
                        endYear: 2035,
                        recurring: true,
                        inflationAdjusted: true,
                        inflationType: 'CPI',
                        inflationRate: ''
                    });
                    $scope.refreshSpendingForm();
                }
                $scope.removeObject = function (index, array) {
                    array.splice(index, 1);
                }
                // TODO: These there methods which clear a property of an object in an array could probably be generalized.
                $scope.changeInflationAdjusted = function (index, array) {
                    var object = array[index];
                    if (!object.inflationAdjusted) {
                        //object.inflationType = '';
                    }
                    $scope.changeInflationType(index, array);
                }
                $scope.changeInflationType = function (index, array) {
                    var object = array[index];
                    if (object.inflationType != 'constant') {
                        //object.inflationRate = '';
                    }
                }
                $scope.clearEndYear = function (index, array) {
                    var object = array[index];
                    if (!object.recurring) {
                        object.endYear = '';
                    }
                }
                $scope.clearProperty = function (clear, path) {
                    if (clear) {
                        var pathArray = path.split('.');
                        var property = $scope;
                        for (var i = 0; i < pathArray.length; i++) {
                            if (i == (pathArray.length - 1)) {
                                property[pathArray[i]] = '';
                            } else {
                                property = property[pathArray[i]];
                            }
                        }
                    }
                }
                $scope.changeLabel = function (label) {
                    if ($scope.data.spending.percentageOfPortfolioFloorType == "definedValue") {
                        $(".spending-floor-span").html("$");
                    } else {
                        $(".spending-floor-span").html("%");
                    }
                    if ($scope.data.spending.percentageOfPortfolioCeilingType == "definedValue") {
                        $(".spending-ceiling-span").html("$");
                    } else {
                        $(".spending-ceiling-span").html("%");
                    }
                }

                $scope.portfolioCheck = function (value) {
                    console.log("Validating...");
                    return (value > 0);
                };
                // Setup the spending form when the controller loads.
                $scope.refreshSpendingForm()
            }
        ]);

</script>
</body>
</html>
